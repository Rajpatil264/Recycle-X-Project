-- Supplier Table
CREATE TABLE Supplier (
    supplier_id INT PRIMARY KEY AUTO_INCREMENT,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    mobile_number VARCHAR(15) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    state VARCHAR(50) NOT NULL,
    city VARCHAR(50) NOT NULL,
    pincode CHAR(6) NOT NULL,
    supplier_type ENUM('Individual', 'Organization', 'Government') NOT NULL DEFAULT 'Individual',
    
    -- Maintaining the logs of Operations
    registered_at TIMESTAMP  DEFAULT CURRENT_TIMESTAMP  INVISIBLE,
    last_modified_at TIMESTAMP  DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP INVISIBLE,
    last_modified_by VARCHAR(255)  DEFAULT (CURRENT_USER) INVISIBLE,

    -- Extra column for future use
    extra_col1 VARCHAR(255)  DEFAULT NULL INVISIBLE,
    extra_col2 VARCHAR(255)  DEFAULT NULL INVISIBLE,
    extra_col3 VARCHAR(255)  DEFAULT NULL INVISIBLE,
    extra_col4 VARCHAR(255)  DEFAULT NULL INVISIBLE,
    extra_col5 VARCHAR(255)  DEFAULT NULL INVISIBLE
);

-- Indexes on the Supplier Table
CREATE INDEX idx_supplier_first_name ON Supplier (first_name);

-- ServiceZones table (Common for both Supplier & Consumer)
CREATE TABLE ServiceZones (
    pincode VARCHAR(10) PRIMARY KEY,
    state VARCHAR(100) NOT NULL UNIQUE,
    city VARCHAR(100) NOT NULL,
    district VARCHAR(100) NOT NULL,
    service_type ENUM('Delivery', 'Pickup', 'Both') NOT NULL
);


-- Trash Categories Table
CREATE TABLE TrashCategories (
    category_id INT PRIMARY KEY,
    category_name VARCHAR(255) NOT NULL UNIQUE,
    category_description TEXT NOT NULL,

    -- Maintaining the logs of Operations
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP INVISIBLE,
    last_modified_at TIMESTAMP  DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP INVISIBLE,
    last_modified_by VARCHAR(255)  NOT NULL DEFAULT (CURRENT_USER) INVISIBLE,

    -- Extra column for future use
    extra_col1 VARCHAR(255) DEFAULT NULL INVISIBLE,
    extra_col2 VARCHAR(255) DEFAULT NULL INVISIBLE,
    extra_col3 VARCHAR(255) DEFAULT NULL INVISIBLE,
    extra_col4 VARCHAR(255) DEFAULT NULL INVISIBLE,
    extra_col5 VARCHAR(255) DEFAULT NULL INVISIBLE
);

-- Trash Sub-Categories Table
CREATE TABLE TrashSubCategories (
    subcategory_id INT PRIMARY KEY,
    category_id INT NOT NULL,
    subcategory_name VARCHAR(255) NOT NULL UNIQUE,
    price_per_kg FLOAT NOT NULL,
    category_description TEXT NOT NULL,

    -- Maintaining the logs of Operations    
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP INVISIBLE,
    last_modified_at TIMESTAMP  DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP INVISIBLE,
    last_modified_by VARCHAR(255)  NOT NULL DEFAULT (CURRENT_USER) INVISIBLE,

    -- Extra column for future use
    extra_col1 VARCHAR(255) DEFAULT NULL INVISIBLE,
    extra_col2 VARCHAR(255) DEFAULT NULL INVISIBLE,
    extra_col3 VARCHAR(255) DEFAULT NULL INVISIBLE,
    extra_col4 VARCHAR(255) DEFAULT NULL INVISIBLE,
    extra_col5 VARCHAR(255) DEFAULT NULL INVISIBLE,

    -- Foreign key 
    FOREIGN KEY (category_id) REFERENCES TrashCategories(category_id)
);


-- (Many to Many Relationship table) Supplier & Categories
CREATE TABLE SupplierSelections (
    selection_id INT AUTO_INCREMENT PRIMARY KEY,
    supplier_id INT NOT NULL,
    category_id INT NOT NULL,
  
    -- Foreign key 
    FOREIGN KEY (supplier_id) REFERENCES Supplier(supplier_id),
    FOREIGN KEY (category_id) REFERENCES TrashCategories(category_id)
);

-- Supplier Order table
CREATE TABLE SupplierOrders (
    order_id INT AUTO_INCREMENT PRIMARY KEY,
    supplier_id INT NOT NULL,
    order_date DATE NOT NULL,
    order_time TIME NOT NULL,
    order_status ENUM('pending', 'completed', 'cancelled') DEFAULT 'pending',

    -- Maintaining the logs of Operations   
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP INVISIBLE,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP INVISIBLE,

    -- Foreign key 
    FOREIGN KEY (supplier_id) REFERENCES Supplier(supplier_id)
);

-- Order Item table
CREATE TABLE SupplierOrderItems (
    item_id INT AUTO_INCREMENT PRIMARY KEY,
    order_id INT NOT NULL,
    subcategory_id INT NOT NULL,

    -- Quantity must be greater than 1Kg
    quantity_kg FLOAT NOT NULL CHECK(quantity_kg > 1),
   
    -- Foreign key 
    FOREIGN KEY (order_id) REFERENCES SupplierOrders(order_id),
    FOREIGN KEY (subcategory_id) REFERENCES TrashSubCategories(subcategory_id)
);

-- Pickup Address for each order
CREATE TABLE PickupAddress (
    order_id INT PRIMARY KEY,
    supplier_name VARCHAR(255) NOT NULL,
    state VARCHAR(100) NOT NULL,
    city VARCHAR(100) NOT NULL,
    pincode VARCHAR(10) NOT NULL,
    street_name VARCHAR(255),
    landmark VARCHAR(255),

    -- Maintaining the logs of Operations   
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP INVISIBLE,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP INVISIBLE,

    -- Foreign key 
    FOREIGN KEY (order_id) REFERENCES SupplierOrders(order_id)
);
